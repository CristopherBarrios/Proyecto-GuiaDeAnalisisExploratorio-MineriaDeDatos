---
title: "Proyect"
author: 'Cristopher Barrios, Elean Rivas, Angel Higueros, Mariana David '
date: "16/2/2023"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

librerias
```{r message=FALSE, warning=FALSE}
library(haven)
library(stats)
library(dplyr)
library(ggplot2)
library(cluster) #Para calcular la silueta
library(e1071)#para cmeans
library(mclust) #mixtures of gaussians
library(fpc) #para hacer el plotcluster
library(NbClust) #Para determinar el número de clusters óptimo
library(factoextra) #Para hacer gráficos bonitos de clustering
library(hopkins) #Para revisar si vale la pena hacer agrupamiento
library(GGally) #Para hacer el conjunto de graficos
library(FeatureImpCluster) #Para revisar la importancia de las variables en los grupos. # nolint
library(pheatmap) #Para hacer mapa de calor
```

datos
```{r}
M2009 <- read_sav("Matrimonios/Matrimonio2009.sav") # nolint
M2010 <- read_sav("Matrimonios/Matrimonio2010.sav") # nolint
M2011 <- read_sav("Matrimonios/Matrimonio2011.sav") # nolint
M2012 <- read_sav("Matrimonios/Matrimonio2012.sav") # nolint
M2013 <- read_sav("Matrimonios/Matrimonio2013.sav") # nolint
M2014 <- read_sav("Matrimonios/Matrimonio2014.sav") # nolint
M2015 <- read_sav("Matrimonios/Matrimonio2015.sav") # nolint
M2016 <- read_sav("Matrimonios/Matrimonio2016.sav") # nolint
M2017 <- read_sav("Matrimonios/Matrimonio2017.sav") # nolint
M2018 <- read_sav("Matrimonios/Matrimonio2018.sav") # nolint
M2019 <- read_sav("Matrimonios/Matrimonio2019.sav") # nolint
M2020 <- read_sav("Matrimonios/Matrimonio2020.sav") # nolint
M2021 <- read_sav("Matrimonios/Matrimonio2021.sav") # nolint

```
Nacimiento
```{r}
N2009 <- read_sav("Nacimientos/Nacimiento2009.sav") # nolint
N2010 <- read_sav("Nacimientos/Nacimiento2010.sav") # nolint
N2011 <- read_sav("Nacimientos/Nacimiento2011.sav") # nolint
N2012 <- read_sav("Nacimientos/Nacimiento2012.sav") # nolint
N2013 <- read_sav("Nacimientos/Nacimiento2013.sav") # nolint
N2014 <- read_sav("Nacimientos/Nacimiento2014.sav") # nolint
N2015 <- read_sav("Nacimientos/Nacimiento2015.sav") # nolint
N2016 <- read_sav("Nacimientos/Nacimiento2016.sav") # nolint
N2017 <- read_sav("Nacimientos/Nacimiento2017.sav") # nolint
N2018 <- read_sav("Nacimientos/Nacimiento2018.sav") # nolint
N2019 <- read_sav("Nacimientos/Nacimiento2019.sav") # nolint
N2020 <- read_sav("Nacimientos/Nacimiento2020.sav") # nolint
N2021 <- read_sav("Nacimientos/Nacimiento2021.sav") # nolint
```
Divorcios
```{r}
D2009 <- read_sav("Divorcios/Divorcio2009.sav") # nolint
D2010 <- read_sav("Divorcios/Divorcio2010.sav") # nolint
D2011 <- read_sav("Divorcios/Divorcio2011.sav") # nolint
D2012 <- read_sav("Divorcios/Divorcio2012.sav") # nolint
D2013 <- read_sav("Divorcios/Divorcio2013.sav") # nolint
D2014 <- read_sav("Divorcios/Divorcio2014.sav") # nolint
D2015 <- read_sav("Divorcios/Divorcio2015.sav") # nolint
D2016 <- read_sav("Divorcios/Divorcio2016.sav") # nolint
D2017 <- read_sav("Divorcios/Divorcio2017.sav") # nolint
D2018 <- read_sav("Divorcios/Divorcio2018.sav") # nolint
D2019 <- read_sav("Divorcios/Divorcio2019.sav") # nolint
D2020 <- read_sav("Divorcios/Divorcio2020.sav") # nolint
D2021 <- read_sav("Divorcios/Divorcio2021.sav") # nolint
```


## Descripción variables y observaciones 
Comience describiendo cuantas variables y observaciones tiene disponibles, el
tipo de cada una de las variables.

Las bases de datos de matrimonios cuentan con diferentes cantidades de variables,pero las 22 más comunes son:
---Para divorcios---
DEPREG: cualitativa
MUPREG: cualitativa
MESREG: cualitativa
AÑOREG: cuantitativa discreta
DIAOCU: cuantitativa
MESOCU: cualitativa
ANOOCU: cuantitativa discreta
DEPOCU: cualitativa
MUPOCU: cualitativa
EDADHOM: cuantitativa discreta
EDADMUJ: cuantitativa discreta
GETHOM: cualitativa
GETMUJ: cualitativa
NACHOM: cualitativa
NACMUJ: cualitativa
OCUHOM: cualitativa
OCUMUJ: cualitativa
MEVER: cualitativa
ANOVER: cualitativa


## Resumen de datos 
Haga un resumen de las variables numéricas e investigue si siguen una
distribución normal y tablas de frecuencia para las variables categóricas, escriba lo
que vaya encontrando. 

```{r}
#summary(M2009)
# Crear una lista con los conjuntos de datos
datasets <- list(D2009, D2010, D2011, D2012, D2013, D2014, D2015, D2016, D2017, D2018, D2019, D2020, D2021)

# Crear un bucle for para analizar cada conjunto de datos y obtener los nombres de las variables numéricas
for (i in 1:length(datasets)) {
  vars_numéricas <- sapply(datasets[[i]], is.numeric)
  print(names(vars_numéricas[vars_numéricas]))
}
```


## Variables importantes
Cruce las variables que considere que son las más importantes para hallar los
elementos clave que lo pueden llevar a comprender lo que está causando el
problema encontrado.

Tiempo: Es importante poder ver el cambio a través del tiempo, si ha habido un incremente o decremento, tanto en matrimonios como en divorcios

NUNUHO:"Número de nupcias del hombre"
NUNUMU:"Número de nupcias de la mujer"

```{r}
M2021[, c(7, 8)]

```

Saber si una persona ha estado previamente casada y si esto influye en la posibilidad de divorcio, cómo hipotesis se espera que las personas que han tenido más de dos nupcias antes, son más propensas al divorcio

Edadhom: "Edad del hombre"
Edadmuj: "Edad de la mujer"

```{r}
D2021[, c(10, 11)]

```

La edad puede ser un dato interesante a explorar, esto para saber si los jovenes tienen más tendencia a casarse o divorcioarse y si los matrimonios más duraderos tienen menos divorcios

Genero: Es interesante ver que genero es más propenso a los divorcios, esto también puede estar relacionado con la cantidad de nupcias de una persona

Efectos de la pandemia: Ver como los divorcios y matrimonios se comportaron a partir de marzo de 2020 que fue el momento en que la cuarentena empezó a hacerse efectiva



## Graficos exploratorios 
Haga gráficos exploratorios que le de ideas del estado de los datos.

-----------------------------------------------------------------------------------------
## Analisis 

## Divorcios
```{r}
  EdadMujD2009 <- sum(D2009$Edadmuj)
  EdadMujD2010 <- sum(D2010$edadmuj)
  EdadMujD2011 <- sum(D2011$edadmuj)
  EdadMujD2012 <- sum(D2012$EDADMUJ)
  EdadMujD2013 <- sum(D2013$EDADMUJ)
  EdadMujD2014 <- sum(D2014$EDADMUJ)
  EdadMujD2015 <- sum(D2015$EDADMUJ)
  EdadMujD2016 <- sum(D2016$EDADMUJ)
  EdadMujD2017 <- sum(D2017$EDADMUJ)
  EdadMujD2018 <- sum(D2018$EDADMUJ)
  EdadMujD2019 <- sum(D2019$EDADMUJ)
  EdadMujD2020 <- sum(D2020$EDADMUJ)
  EdadMujD2021 <- sum(D2021$EDADMUJ)
```

```{r}
dfD <- data.frame (año  = c("2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017","2018","2019","2020","2021"), matrimonios = c(EdadMujD2009, EdadMujD2010, EdadMujD2011, EdadMujD2012, EdadMujD2013, EdadMujD2014, EdadMujD2015, EdadMujD2016, EdadMujD2017, EdadMujD2018, EdadMujD2019, EdadMujD2020, EdadMujD2021))
print(dfD)
```

```{r}
ggplot(dfD, aes(x=año, y=matrimonios, group = 1)) + 
  geom_point(size = 2, color = "green") + 
  geom_line(color="green") +
  labs(x = "Año", y = "Divorcios", title = "Divorcios")
```

## Matrimonios
```{r}
  EdadMujM2009 <- sum(M2009$Edadmuj)
  EdadMujM2010 <- sum(M2010$edadmuj)
  EdadMujM2011 <- sum(M2011$edadmuj)
  EdadMujM2012 <- sum(M2012$EDADMUJ)
  EdadMujM2013 <- sum(M2013$EDADMUJ)
  EdadMujM2014 <- sum(M2014$EDADMUJ)
  EdadMujM2015 <- sum(M2015$EDADMUJ)
  EdadMujM2016 <- sum(M2016$EDADMUJ)
  EdadMujM2017 <- sum(M2017$EDADMUJ)
  EdadMujM2018 <- sum(M2018$EDADMUJ)
  EdadMujM2019 <- sum(M2019$EDADMUJ)
  EdadMujM2020 <- sum(M2020$EDADMUJ)
  EdadMujM2021 <- sum(M2021$EDADMUJ)
```

```{r}
dfD <- data.frame (año  = c("2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017","2018","2019","2020","2021"), matrimonios = c(EdadMujM2009, EdadMujM2010, EdadMujM2011, EdadMujM2012, EdadMujM2013, EdadMujM2014, EdadMujM2015, EdadMujM2016, EdadMujM2017, EdadMujM2018, EdadMujM2019, EdadMujM2020, EdadMujM2021))
print(dfD)
```

```{r}
ggplot(dfD, aes(x=año, y=matrimonios, group = 1)) + 
  geom_point(size = 2, color = "green") + 
  geom_line(color="green") +
  labs(x = "Año", y = "Matrimonios", title = "Matrimonios")
```

## Nacimientos
```{r}
  EdadMujN2009 <- sum(N2009$Edadm)
  EdadMujN2010 <- sum(N2010$Edadm)
  EdadMujN2011 <- sum(N2011$Edadm)
  EdadMujN2012 <- sum(N2012$Edadm)
  EdadMujN2013 <- sum(N2013$Edadm)
  EdadMujN2014 <- sum(N2014$Edadm)
  EdadMujN2015 <- sum(N2015$Edadm)
  EdadMujN2016 <- sum(N2016$Edadm)
  EdadMujN2017 <- sum(N2017$Edadm)
  EdadMujN2018 <- sum(N2018$Edadm)
  EdadMujN2019 <- sum(N2019$Edadm)
  EdadMujN2020 <- sum(N2020$Edadm)
  EdadMujN2021 <- sum(N2021$Edadm)
```

```{r}
dNac <- data.frame (año  = c("2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017","2018","2019","2020","2021"), matrimonios = c(EdadMujN2009, EdadMujN2010, EdadMujN2011, EdadMujN2012, EdadMujN2013, EdadMujN2014, EdadMujN2015, EdadMujN2016, EdadMujN2017, EdadMujN2018, EdadMujN2019, EdadMujN2020, EdadMujN2021))
print(dNac)
```

```{r}
ggplot(dNac, aes(x=año, y=matrimonios, group = 1)) + 
  geom_point(size = 2, color = "green") + 
  geom_line(color="green") +
  labs(x = "Año", y = "Nacimientos", title = "Nacimientos")
```

--------------------------------------------------------------------------------

## Histogramas
2009
```{r}
library(dplyr)
library(ggplot2)

D2009 <- subset(D2009, Edadmuj < 999)

barplot(table(D2009$Edadmuj), main = "Edad de la mujer en divorcios 2009", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2010
```{r}
D2010 <- subset(D2010, edadmuj < 999)

barplot(table(D2010$edadmuj), main = "Edad de la mujer en divorcios 2010", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2011
```{r}
D2011 <- subset(D2011, edadmuj < 999)

barplot(table(D2011$edadmuj), main = "Edad de la mujer en divorcios 2011", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2012
```{r}
D2012 <- subset(D2012, EDADMUJ < 999)

barplot(table(D2012$EDADMUJ), main = "Edad de la mujer en divorcios 2012", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2013
```{r}
D2013 <- subset(D2013, EDADMUJ < 999)

barplot(table(D2013$EDADMUJ), main = "Edad de la mujer en divorcios 2013", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2014
```{r}
D2014 <- subset(D2014, EDADMUJ < 999)

barplot(table(D2014$EDADMUJ), main = "Edad de la mujer en divorcios 2014", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2015
```{r}
D2015 <- subset(D2015, EDADMUJ < 999)

barplot(table(D2015$EDADMUJ), main = "Edad de la mujer en divorcios 2015", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2016
```{r}
D2016 <- subset(D2016, EDADMUJ < 999)

barplot(table(D2016$EDADMUJ), main = "Edad de la mujer en divorcios 2016", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2017
```{r}
D2017 <- subset(D2017, EDADMUJ < 999)

barplot(table(D2017$EDADMUJ), main = "Edad de la mujer en divorcios 2017", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2018
```{r}
D2018 <- subset(D2018, EDADMUJ < 999)

barplot(table(D2018$EDADMUJ), main = "Edad de la mujer en divorcios 2018", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2019
```{r}
D2019 <- subset(D2019, EDADMUJ < 999)

barplot(table(D2019$EDADMUJ), main = "Edad de la mujer en divorcios 2019", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2020
```{r}
D2020 <- subset(D2020, EDADMUJ < 999)

barplot(table(D2020$EDADMUJ), main = "Edad de la mujer en divorcios 2020", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2021
```{r}
D2021 <- subset(D2021, EDADMUJ < 999)

barplot(table(D2021$EDADMUJ), main = "Edad de la mujer en divorcios 2021", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```
--------------------------------------------------------------------------
## Combinando datos
```{r}
colnames(D2009) <- c("DEPREG", "MUPREG", "MESREG", "AÑOREG", "DIAOCU", "MESOCU", "AÑOOCU", "DEPOCU", "MUPOCU", "EDADHOM", "EDADMUJ", "PPERHOM", "PPERMUJ", "NACHOM", "NACMUJ", "CIUOHOM", "CIUOMUJ", "Mever", "Anover")
colnames(D2010) <- c("DEPREG", "MUPREG", "MESREG", "AÑOREG", "DIAOCU", "MESOCU", "AÑOOCU", "DEPOCU", "MUPOCU", "EDADHOM", "EDADMUJ", "PPERHOM", "PPERMUJ", "NACHOM", "NACMUJ", "ESCHOM", "ESCMUJ", "CIUOHOM", "CIUOMUJ")
colnames(D2011) <- c("DEPREG", "MUPREG", "MESREG", "AÑOREG", "DIAOCU", "MESOCU", "AÑOOCU", "DEPOCU", "MUPOCU", "EDADHOM", "EDADMUJ", "PPERHOM", "PPERMUJ", "NACHOM", "NACMUJ", "ESCHOM", "ESCMUJ", "CIUOHOM", "CIUOMUJ")
colnames(D2012) <- c("DEPREG",  "MUPREG",  "MESREG",  "AÑOREG",  "DIAOCU",  "MESOCU",  "DEPOCU",  "MUPOCU", "EDADHOM", "EDADMUJ", "PPERHOM",  "PPERMUJ",  "NACHOM",  "NACMUJ",  "ESCHOM",  "ESCMUJ", "CIUOHOM",  "CIUOMUJ") 
colnames(D2013) <- c( "DEPREG",  "MUPREG",  "MESREG",  "AÑOREG",  "DIAOCU",  "MESOCU",  "DEPOCU",  "MUPOCU",  "EDADHOM", "EDADMUJ", "PPERHOM",  "PPERMUJ",  "NACHOM",  "NACMUJ",  "ESCHOM",  "ESCMUJ",  "CIUOHOM", "CIUOMUJ")
colnames(D2014) <- c( "DEPREG",  "MUPREG",  "MESREG",  "AÑOREG",  "DIAOCU",  "MESOCU",  "DEPOCU",  "MUPOCU", "EDADHOM", "EDADMUJ", "PPERHOM",  "PPERMUJ",  "NACHOM",  "NACMUJ",  "ESCHOM",  "ESCMUJ",  "CIUOHOM", "CIUOMUJ")
colnames(D2015) <- c("DEPREG",  "MUPREG",  "MESREG",  "AÑOREG",  "DIAOCU",  "MESOCU",  "AÑOOCU",  "DEPOCU",  "MUPOCU",  "EDADHOM", "EDADMUJ", "PPERHOM", "PPERMUJ",  "NACHOM", "NACMUJ",  "ESCHOM",  "ESCMUJ",  "CIUOHOM", "CIUOMUJ")
```

```{r}
D2009 <- D2009 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2010 <- D2010 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2011 <- D2011 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2012 <- D2012 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2013 <- D2013 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2014 <- D2014 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2015 <- D2015 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2016 <- D2016 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2017 <- D2017 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2018 <- D2018 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2019 <- D2019 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2020 <- D2020 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2021 <- D2021 %>% mutate(AÑOREG = as.numeric(AÑOREG))
```

```{r}
D2009 <- D2009 %>% mutate(AÑOOCU = as.numeric(AÑOOCU))
D2010 <- D2010 %>% mutate(AÑOOCU = as.numeric(AÑOOCU))
D2011 <- D2011 %>% mutate(AÑOOCU = as.numeric(AÑOOCU))
```

```{r}
D2009 <- D2009 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2010 <- D2010 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2011 <- D2011 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2012 <- D2012 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2013 <- D2013 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2014 <- D2014 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2015 <- D2015 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2016 <- D2016 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2017 <- D2017 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2018 <- D2018 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2019 <- D2019 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2020 <- D2020 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2021 <- D2021 %>% mutate(CIUOHOM = as.character(CIUOHOM))
```


```{r}
D2009 <- D2009 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2010 <- D2010 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2011 <- D2011 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2012 <- D2012 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2013 <- D2013 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2014 <- D2014 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2015 <- D2015 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2016 <- D2016 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2017 <- D2017 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2018 <- D2018 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2019 <- D2019 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2020 <- D2020 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2021 <- D2021 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
```


```{r warning=FALSE, unload=TRUE}
#divorcios <- bind_rows(D2009, D2010, D2011, D2012, D2013, D2014, D2015, D2016, D2017, D2018, D2019, D2020, D2021)
divorcios <- bind_rows( D2012, D2013, D2014, D2015, D2016, D2017, D2018, D2019, D2020, D2021)
#l = list(D2012, D2013, D2014, D2015, D2016, D2017, D2018, D2019, D2020, D2021)
#divorcios <- do.call("rbind",l)
```

```{r}
str(divorcios)
```

```{r normalHist, echo=FALSE}
#install.packages("ggplot2",repos = "http://cran.us.r-project.org")
library (ggplot2)
ggplot(data = divorcios, aes(x = AÑOREG)) + 
  geom_histogram(aes(y=..density.., fill = ..count..))+
  scale_fill_gradient(low = "#DCDCDC", high = "#7C7C7C")+
  stat_function(fun = dnorm, colour = "firebrick",
                args = list(mean = mean(divorcios$AÑOREG),
                            sd = sd(divorcios$AÑOREG)))+
  ggtitle("Histograma con curva normal teórica de los registros de divorcios por año ") + 
  theme_bw()

```  


```{r}
boxplot(divorcios$AÑOREG, main = "Caja y Bigotes de registro de divorcios por año (2012 - 2021)", xlab = "Registro por año")
```


### Diagrama de qqnormal 
```{r normalQQ, echo=FALSE}
qqnorm(divorcios$AÑOREG, col="blue")
qqline(divorcios$AÑOREG, col="red")
```

## Registros de Edad hombre
### Prueba de normalidad para la edad del hombre:

```{r normalHistEdadHombre, echo=FALSE}
#install.packages("ggplot2",repos = "http://cran.us.r-project.org")
library (ggplot2)
divorciosEdadHom <- subset(divorcios, EDADHOM < 999)

ggplot(data = divorciosEdadHom, aes(x = EDADHOM)) + 
  geom_histogram(aes(y=..density.., fill = ..count..))+
  scale_fill_gradient(low = "#DCDCDC", high = "#7C7C7C")+
  stat_function(fun = dnorm, colour = "firebrick",
                args = list(mean = mean(divorciosEdadHom$EDADHOM),
                            sd = sd(divorciosEdadHom$EDADHOM)))+
  ggtitle("Histograma con curva normal teórica de las edades de los hombres (2012 - 2021)") + 
  theme_bw()
```  

### Diagrama de caja y bigotes
```{r normalBoxEdadHombre, echo=FALSE}
boxplot(divorciosEdadHom$EDADHOM, main = "Caja y Bigotes de edad de los hombres al divorciarse (2012 - 2021)", xlab = "edad")
```

### Diagrama qqnormal
```{r normalQQEdadHombre, echo=FALSE}
qqnorm(divorciosEdadHom$EDADHOM, col="blue")
qqline(divorciosEdadHom$EDADHOM, col="red")
```


## Registros de edad de mujeres
### Prueba de normalidad para la edad de la mujer:

```{r normalHistEdadMuje, echo=FALSE}
#install.packages("ggplot2",repos = "http://cran.us.r-project.org")
library (ggplot2)
divorciosEdadMuj <- subset(divorcios, EDADMUJ < 999)

ggplot(data = divorciosEdadMuj, aes(x = EDADMUJ)) + 
  geom_histogram(aes(y=..density.., fill = ..count..))+
  scale_fill_gradient(low = "#DCDCDC", high = "#7C7C7C")+
  stat_function(fun = dnorm, colour = "firebrick",
                args = list(mean = mean(divorciosEdadMuj$EDADMUJ),
                            sd = sd(divorciosEdadMuj$EDADMUJ)))+
  ggtitle("Histograma con curva normal teórica de las edades de las mujeres (2012 - 2021)") + 
  theme_bw()
```  

### Diagrama de caja y bigotes
```{r normalBoxEdadMujer, echo=FALSE}
boxplot(divorciosEdadMuj$EDADMUJ, main = "Caja y Bigotes de edad de las mujeres al divorciarse (2012 - 2021)", xlab = "edad")
```

### Diagrama qqnormal
```{r normalQQEdadMujer, echo=FALSE}
qqnorm(divorciosEdadMuj$EDADMUJ, col="blue")
qqline(divorciosEdadMuj$EDADMUJ, col="red")
```


## Tabla de frecuencias para variables cualitativas

### Tabla de frecuencias para el departamento de ocurrencia y representación gráfica
```{r}
D2009 <- D2009 %>%
  mutate_if(is.labelled,list(as_factor))
D2010 <- D2010 %>%
  mutate_if(is.labelled,list(as_factor))
D2011 <- D2011 %>%
  mutate_if(is.labelled,list(as_factor))
D2012 <- D2012 %>%
  mutate_if(is.labelled,list(as_factor))
D2013 <- D2013 %>%
  mutate_if(is.labelled,list(as_factor))
D2014 <- D2014 %>%
  mutate_if(is.labelled,list(as_factor))
D2015 <- D2015 %>%
  mutate_if(is.labelled,list(as_factor))
D2016 <- D2016 %>%
  mutate_if(is.labelled,list(as_factor))
D2017 <- D2017 %>%
  mutate_if(is.labelled,list(as_factor))
D2018 <- D2018 %>%
  mutate_if(is.labelled,list(as_factor))
D2019 <- D2019 %>%
  mutate_if(is.labelled,list(as_factor))
D2020 <- D2020 %>%
  mutate_if(is.labelled,list(as_factor))
D2021 <- D2021 %>%
  mutate_if(is.labelled,list(as_factor))

divorciosLabels <- bind_rows( D2012, D2013, D2014, D2015, D2016, D2017, D2018, D2019, D2020, D2021)
```


```{r frecuenciaDepartamento, echo=FALSE}
table(divorciosLabels$DEPOCU)
counts <- table(divorciosLabels$DEPOCU)
barplot(counts, las = 2, cex.names=.5 ,main = "Distribución de departamento de ocurrencia (2012 - 2021)", xlab = "Departamento de ocurrencia")
```

### Tabla de frecuencias para el municipio de ocurrencia
```{r frecuenciaMunicipio, echo=FALSE}
table(divorciosLabels$MUPOCU)
counts <- table(divorciosLabels$MUPOCU)
barplot(counts, las = 2, cex.names=.5 ,main = "Distribución de municipio de ocurrencia (2012 - 2021)", xlab = "Municipio de ocurrencia")
```


### Tabla de frecuencias para la escolaridad del hombre

```{r frecuenciaEscolaridadHombre, echo=FALSE}
table(divorciosLabels$ESCHOM)
counts <- table(divorciosLabels$ESCHOM)
barplot(counts, las = 2, cex.names=.10 ,main = "Distribución de escolaridad de los hombres (2012 - 2021)", xlab = "Escolaridad del hombre")
```

### Tabla de frecuencias para la escolaridad de la Mujer
```{r frecuenciaEscolaridadMujer, echo=FALSE}

table(divorciosLabels$ESCMUJ)
counts <- table(divorciosLabels$ESCMUJ)
barplot(counts, las = 2, cex.names=.10 ,main = "Distribución de escolaridad de las mujeres (2012 - 2021)", xlab = "Escolaridad de las mujeres")
```

### Tabla de frecuencias para el grupo étnico del hombre
```{r frecuenciaEtniaHombre, echo=FALSE}
divorciosLabels$PPERHOM <- gsub("Mestizo / ladino", "Ladino / Mestizo", divorciosLabels$PPERHOM)
divorciosLabels$PPERHOM <- gsub("Mestizo / Ladino", "Ladino / Mestizo", divorciosLabels$PPERHOM)
divorciosLabels$PPERHOM <- gsub("Garifuna", "Garífuna", divorciosLabels$PPERHOM)
divorciosLabels$PPERHOM <- gsub("Xinca", "Xinka", divorciosLabels$PPERHOM)


table(divorciosLabels$PPERHOM)
counts <- table(divorciosLabels$PPERHOM)
barplot(counts, las = 2, cex.names=.8 ,main = "Distribución de etnia de los hombres (2012 - 2021)", xlab = "Etnia del hombre")
```

### Tabla de frecuencias para el grupo étnico de la mujer
```{r frecuenciaEtniaMujer, echo=FALSE}
divorciosLabels$PPERMUJ <- gsub("Mestizo / ladino", "Ladino / Mestizo", divorciosLabels$PPERMUJ)
divorciosLabels$PPERMUJ <- gsub("Mestizo / Ladino", "Ladino / Mestizo", divorciosLabels$PPERMUJ)
divorciosLabels$PPERMUJ <- gsub("Garifuna", "Garífuna", divorciosLabels$PPERMUJ)
divorciosLabels$PPERMUJ <- gsub("Xinca", "Xinka", divorciosLabels$PPERMUJ)

table(divorciosLabels$PPERMUJ)
counts <- table(divorciosLabels$PPERMUJ)
barplot(counts, las = 2, cex.names=.8 ,main = "Distribución de etnia de las mujeres (2012 - 2021)", xlab = "Etnia de las mujeres")
```

## Correlacion entre edades de los cónyuges

```{r CorrelacionEdades, echo=FALSE}
divorciosEdad <- subset(divorcios, EDADMUJ < 999)
divorciosEdad <- subset(divorciosEdad, EDADHOM < 999)

plot(x = divorciosEdad$EDADHOM, y= divorciosEdad$EDADMUJ, xlab= "Edad del Hombre", ylab= "Edad de la mujer", main = "Correlación entre las edades de los cónyuges (2012 - 2021)")
abline(lm(divorciosEdad$EDADMUJ ~ divorciosEdad$EDADHOM), col = "red")
```

## Ocupacion en Hombre 2009-2021
```{r normalHistEdadHombre1, echo=FALSE}
#install.packages("ggplot2",repos = "http://cran.us.r-project.org")


#library (ggplot2)
#divorciosOcupHombre <- subset(divorciosLabels, CIUOHOM)

#barplot(table(divorciosOcupHombre$CIUOHOM), main = "Ocupaciones del Hombres en divorcios 2009-2021", xlab = "Ocupacion", ylab = "Cantidad", col = "steelblue" , border = "pink")

```  

## ocupacion en Mujeres 2009-2021
```{r normalHistEdadHombre2, echo=FALSE}
#install.packages("ggplot2",repos = "http://cran.us.r-project.org")

#library (ggplot2)
#divorciosOcupMujeres <- subset(divorciosLabels, CIUOMUJ)

#barplot(table(divorciosOcupMujeres$CIUOMUJ), main = "Ocupaciones de la Mujer en divorcios 2009-2021", xlab = "Ocupacion", ylab = "Cantidad", col = "steelblue" , border = "pink")

```  
## Clustering
Haga un agrupamiento (clustering) e interprete los resultados.
```{r}
divorcios$AÑOOCU <- as.numeric(factor(divorcios$AÑOOCU))
datosClustering <- divorcios[,c("AÑOREG","EDADHOM","EDADMUJ","AÑOOCU")]
data_omit <- na.omit(datosClustering) 
summary(datosClustering)

```


```{r cantClusters, echo=FALSE}
wss <- (nrow(data_omit[,1:4])-1)*sum(apply(data_omit[,1:4],2,var))
for (i in 2:10) 
  wss[i] <- sum(kmeans(data_omit[,1:4], centers=i)$withinss)
plot(1:10, wss, type="b", xlab="Number of Clusters",  ylab="Within groups sum of squares")
```


## Edad mujeres y hombres en divorcio entre 2009-2021 por medio de k-means  

```{r kmeans, echo=FALSE}
#datosClusteringK <- divorcios[, c("EDADHOM", "EDADMUJ", "MESREG")]
#datosNormalizados <- scale(datosClusteringK)
#set.seed(123)
#modeloKMeans <- kmeans(datosNormalizados, centers = 4)
#library(plotly)
#plot_ly(datosClusteringK, x = ~EDADHOM, y = ~EDADMUJ, z = ~MESREG, color = modeloKMeans$cluster) %>% 
#  add_markers() %>% 
#  layout(scene = list(xaxis = list(title = "Edad Hombre"),
#                      yaxis = list(title = "Edad Mujer"),
#                      zaxis = list(title = "Mes de registro")))

```



## Agrupamiento por medio de k-means  

```{r kmeans2, echo=FALSE}
library(fpc)
datosClusteringlol <- na.omit(datosClustering)
km<-kmeans(datosClusteringlol[,1:4],2,iter.max =100)
datosClusteringlol$grupo<-km$cluster
plotcluster(datosClusteringlol[,1:4],km$cluster)
gkm1<- datosClusteringlol[datosClusteringlol$grupo==1,]
gkm2<- datosClusteringlol[datosClusteringlol$grupo==2,]

```


## Mixture of gaussians

```{r gaussians, echo = FALSE}
library(mclust)
mc<-Mclust(datosClusteringlol[,1:4],2)
plot(mc, what = "classification", main="MClust Classification")
datosClusteringlol$mxGau<-mc$classification
g1PMC<-datosClusteringlol[datosClusteringlol$mxGau==1,]
g2PMC<-datosClusteringlol[datosClusteringlol$mxGau==2,]

```

## Fuzzy C-means

```{r fuzzy2, echo=FALSE}
library(e1071)
library(cluster)
set.seed(123)
fcmf<-cmeans(datosClusteringlol[,1:4],2)
datosClusteringlol$FCGrupos<-fcmf$cluster
g1FCM <- datosClusteringlol[datosClusteringlol$FCGrupos == 1,]
g2FCM <- datosClusteringlol[datosClusteringlol$FCGrupos == 2,]

clusplot(datosClusteringlol, fcmf$cluster, color=TRUE, shade = TRUE, labels = 2,lines = 0)

library(fpc)
plotcluster(datosClusteringlol,fcmf$cluster)
```


```{r analisis de cada grupo kmeans, echo=FALSE}
summary(gkm1)
summary(gkm2)

```

```{r analisis de cada grupo mixture gaussians, echo=FALSE}
summary(g1PMC)
summary(g2PMC)

```

```{r analisis de cada grupo fuzzy c means, echo=FALSE}
summary(g1FCM)
summary(g2FCM)

```

## Evaluación de la tendencia de agrupamiento:

### En hombres

```{r Evaluacion de la tendencia de agrupamiento:cluster jerarquico, echo=FALSE}
clarax <- clara(divorciosEdadMuj$EDADMUJ , 2)
# Cluster plot
  
plot(silhouette(clarax),  col = 2:3, main = "Silhouette plot")  
```

### En mujeres

```{r elegir los algoritmos de agrupación apropiados, echo=FALSE}
clorax <- clara(divorciosEdadHom$EDADHOM , 2)
# Cluster plot
plot(silhouette(clorax),  col = 2:3, main = "Silhouette plot")
```

# Predicciones
divorciosLabels

```{r}
# str(divorciosLabels)
```

```{r Clasificatión, echo=TRUE}

# divorciosLabels$EDADMUJ <- as.numeric(as.character(divorciosLabels$EDADMUJ))  # Convierte a numérico
# divorciosLabels$clasification <- ifelse(divorciosLabels$EDADMUJ <= 17, "Menor", ifelse(divorciosLabels$EDADMUJ >= 18, "Mayor", NA))
# 
# print(unique(divorciosLabels$clasification)) # Imprime los valores únicos de la columna "clasification"
# divorciosLabels$y <- factor(divorciosLabels$clasification)
# 
# str(divorciosLabels) # Verifica la estructura de los datos nuevamente

```

```{r}
# divorciosLabels$EDADHOM <- as.numeric(as.character(divorciosLabels$EDADHOM))
# divorciosLabels$EDADMUJ <- as.numeric(as.character(divorciosLabels$EDADMUJ))
# 
#  datosMDD <- divorciosLabels %>% filter(EDADMUJ >= 12)
#  datosMDD <- datosMDD %>% filter(EDADHOM >= 14)
#  datosMDD <- datosMDD[,-20]
#  datosMDD <- datosMDD[,-10]
#  datosMDD <- datosMDD[complete.cases(datosMDD), ]
# 
#  str(datosMDD)
#  
# datosMDD$DEPREG <- as.factor(datosMDD$DEPREG)
# datosMDD$MUPREG <- as.factor(datosMDD$MUPREG)
# datosMDD$MESREG <- as.factor(datosMDD$MESREG)
# datosMDD$AÑOREG <- as.factor(datosMDD$AÑOREG)
# datosMDD$DIAOCU <- as.factor(datosMDD$DIAOCU)
# datosMDD$MESOCU <- as.factor(datosMDD$MESOCU)
# datosMDD$DEPOCU <- as.factor(datosMDD$DEPOCU)
# datosMDD$MUPOCU <- as.factor(datosMDD$MUPOCU)
# datosMDD$EDADHOM <- as.factor(datosMDD$EDADHOM)
# datosMDD$PPERHOM <- as.factor(datosMDD$PPERHOM)
# datosMDD$PPERMUJ <- as.factor(datosMDD$PPERMUJ)
# datosMDD$NACHOM <- as.factor(datosMDD$NACHOM)
# datosMDD$NACMUJ <- as.factor(datosMDD$NACMUJ)
# datosMDD$ESCHOM <- as.factor(datosMDD$ESCHOM)
# datosMDD$ESCMUJ <- as.factor(datosMDD$ESCMUJ)
# datosMDD$CIUOHOM <- as.factor(datosMDD$CIUOHOM)
# datosMDD$CIUOMUJ <- as.factor(datosMDD$CIUOMUJ)
# datosMDD$AÑOOCU <- as.factor(datosMDD$AÑOOCU)
# 
# str(datosMDD)
```

```{r delvars, echo=TRUE}
#  datosMDD <- datosMDD[,c(5,6,7,8,9,10,15,16,17,18,19)]
#  porciento <- 70/100
#  set.seed(123)
#  trainRowsNumber<-sample(nrow(datosMDD),porciento*nrow(datosMDD))
#  train<-datosMDD[trainRowsNumber,]
#  test<-datosMDD[-trainRowsNumber,]
#  
# str(datosMDD)
```
-----------------------------------------------------------------
```{r}
divorcios <- subset(divorcios, EDADHOM < 999)
divorcios <- subset(divorcios, EDADMUJ < 999)
str(divorcios)

```

```{r Clasificación, echo=FALSE}
divorcios$EDADMUJ <- as.numeric(as.character(divorcios$EDADMUJ))  # Convierte a numérico
divorcios$clasification <- ifelse(divorcios$EDADMUJ <= 17, "Menor", ifelse(divorcios$EDADMUJ >= 18, "Mayor", NA))

print(unique(divorcios$clasification)) # Imprime los valores únicos de la columna "clasification"
divorcios$y <- factor(divorcios$clasification)
```

```{r}
divorcios$EDADHOM <- as.numeric(as.character(divorcios$EDADHOM))
divorcios$EDADMUJ <- as.numeric(as.character(divorcios$EDADMUJ))

 datosMD <- divorcios %>% filter(EDADMUJ >= 12)
 datosMD <- datosMD %>% filter(EDADHOM >= 14)
 datosMD <- datosMD[,-20]
 datosMD <- datosMD[,-10]
 datosMD <- datosMD[complete.cases(datosMD), ]

 
datosMD$DEPREG <- as.factor(datosMD$DEPREG)
datosMD$MUPREG <- as.factor(datosMD$MUPREG)
datosMD$MESREG <- as.factor(datosMD$MESREG)
datosMD$AÑOREG <- as.factor(datosMD$AÑOREG)
datosMD$DIAOCU <- as.factor(datosMD$DIAOCU)
datosMD$MESOCU <- as.factor(datosMD$MESOCU)
datosMD$DEPOCU <- as.factor(datosMD$DEPOCU)
datosMD$MUPOCU <- as.factor(datosMD$MUPOCU)
datosMD$EDADHOM <- as.factor(datosMD$EDADHOM)
datosMD$PPERHOM <- as.factor(datosMD$PPERHOM)
datosMD$PPERMUJ <- as.factor(datosMD$PPERMUJ)
datosMD$NACHOM <- as.factor(datosMD$NACHOM)
datosMD$NACMUJ <- as.factor(datosMD$NACMUJ)
datosMD$ESCHOM <- as.factor(datosMD$ESCHOM)
datosMD$ESCMUJ <- as.factor(datosMD$ESCMUJ)
datosMD$CIUOHOM <- as.factor(datosMD$CIUOHOM)
datosMD$CIUOMUJ <- as.factor(datosMD$CIUOMUJ)
datosMD$AÑOOCU <- as.factor(datosMD$AÑOOCU)

```



```{r delvar, echo=TRUE}
 datosMD <- datosMD[,c(5,6,7,8,9,10,15,16,17,18,19)]
 porciento <- 70/100
 set.seed(123)
 trainRowsNumber<-sample(nrow(datosMD),porciento*nrow(datosMD))
 train<-datosMD[trainRowsNumber,]
 test<-datosMD[-trainRowsNumber,]
 
str(datosMD)

```



Eliminando para liberar memoria
```{r}
rm(clarax)
rm(clorax)
rm(D2009)
rm(D2010)
rm(D2011)
rm(D2012)
rm(D2013)
rm(D2014)
rm(D2015)
rm(D2016)
rm(D2017)
rm(D2018)
rm(D2019)
rm(D2020)
rm(D2021)
rm(data_omit)
rm(datasets)
rm(datosClustering)
rm(datosClusteringlol)
rm(dfD)
rm(dNac)
rm(fcmf)
rm(g1FCM)
rm(g1PMC)
rm(g2FCM)
rm(g2PMC)
rm(gkm1)
rm(gkm2)
rm(km)
rm(M2009)
rm(M2010)
rm(M2011)
rm(M2012)
rm(M2013)
rm(M2014)
rm(M2015)
rm(M2016)
rm(M2017)
rm(M2018)
rm(M2019)
rm(M2020)
rm(M2021)
rm(mc)
rm(N2009)
rm(N2010)
rm(N2011)
rm(N2012)
rm(N2013)
rm(N2014)
rm(N2015)
rm(N2016)
rm(N2017)
rm(N2018)
rm(N2019)
rm(N2020)
rm(N2021)

```


## Algoritmos


### Predicción por medio de Naive Bayes
```{r bayesLabels, echo=TRUE, results = "hide"}
withCallingHandlers({
  suppressPackageStartupMessages(library(caret))
  suppressWarnings({
    library(RWeka)
    modelo <- naiveBayes(train$y ~ ., data = train)
    predBayes <- predict(modelo, newdata = train[, 1:11])
  })
}, warning = function(w) {
  if (grepl("package 'RWeka' was built under R version", w$message))
    return(NULL)
  else
    invokeRestart("muffleWarning")
})


```

```{r}
cm<- caret::confusionMatrix(predBayes,train$y)
cm
```

```{r}
predBayesM <- predict(modelo, newdata = test[,1:11])
test$PredBayes <- predBayesM
cm <- caret::confusionMatrix(test$PredBayes, test$y)
cm
```

## Prediccion por redes neuronales: RWEKA


```{r message=FALSE, warning=FALSE, results = "hide"}
#datosML <- lapply(datosMDD, as.factor)
#install.packages("RWeka")
library (caret)
library(RWeka)
NB <- make_Weka_classifier("weka/classifiers/functions/MultilayerPerceptron")
NB
WOW(NB)
nnodos='11'
modelo.bp<-NB(datosMD$y~., data=datosMD,subset = trainRowsNumber, control=Weka_control(H=nnodos, N=1, G=TRUE), options=NULL)
test$prediccionWeka<-predict(modelo.bp, newdata = test[,1:11])
```

```{r }
cfmWeka<-confusionMatrix(test$prediccionWeka,test$y)
cfmWeka
```

## Prediccion por medio de árboles de decisión
```{r results = "hide"}
library(caret)
trainData <- train[, 1:11]
trainLabels <- train$y
ct <- trainControl(method = "cv", number = 10, verboseIter = TRUE)
modelorf <- suppressWarnings(train(x = trainData, y = trainLabels, method = "rpart", trControl = ct))
prediccionADVC <- suppressWarnings(predict(modelorf, newdata = test[, 1:11]))
test$predADVC <- prediccionADVC
```

```{r}
cfmCaret <- confusionMatrix(test$predADVC, test$y)
cfmCaret
```

```{r}
library(e1071)

# Crear modelo SVM
model_svm <- svm(y ~ ., data = train)
predictions_svm <- predict(model_svm, newdata = test)
confusionMatrix(predictions_svm, test$y)


```

```{r}
library(rpart)

# Crear modelo Árbol de Decisión
model_tree <- rpart(y ~ ., data = train)
predictions_tree <- predict(model_tree, newdata = test, type = "class")
confusionMatrix(predictions_tree, test$y)

```




