---
title: "Proyect"
author: 'Cristopher Barrios, Elean Rivas, Angel Higueros, Mariana David '
date: "16/2/2023"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

librerias
```{r, echo=FALSE}
library(haven)
library(stats)
library(dplyr)
library(ggplot2)
library(cluster) #Para calcular la silueta
library(e1071)#para cmeans
library(mclust) #mixtures of gaussians
library(fpc) #para hacer el plotcluster
library(NbClust) #Para determinar el número de clusters óptimo
library(factoextra) #Para hacer gráficos bonitos de clustering
library(hopkins) #Para revisar si vale la pena hacer agrupamiento
library(GGally) #Para hacer el conjunto de graficos
library(FeatureImpCluster) #Para revisar la importancia de las variables en los grupos. # nolint
library(pheatmap) #Para hacer mapa de calor
```

datos
```{r}
M2009 <- read_sav("Matrimonios/Matrimonio2009.sav") # nolint
M2010 <- read_sav("Matrimonios/Matrimonio2010.sav") # nolint
M2011 <- read_sav("Matrimonios/Matrimonio2011.sav") # nolint
M2012 <- read_sav("Matrimonios/Matrimonio2012.sav") # nolint
M2013 <- read_sav("Matrimonios/Matrimonio2013.sav") # nolint
M2014 <- read_sav("Matrimonios/Matrimonio2014.sav") # nolint
M2015 <- read_sav("Matrimonios/Matrimonio2015.sav") # nolint
M2016 <- read_sav("Matrimonios/Matrimonio2016.sav") # nolint
M2017 <- read_sav("Matrimonios/Matrimonio2017.sav") # nolint
M2018 <- read_sav("Matrimonios/Matrimonio2018.sav") # nolint
M2019 <- read_sav("Matrimonios/Matrimonio2019.sav") # nolint
M2020 <- read_sav("Matrimonios/Matrimonio2020.sav") # nolint
M2021 <- read_sav("Matrimonios/Matrimonio2021.sav") # nolint



```
Nacimiento
```{r}
N2009 <- read_sav("Nacimientos/Nacimiento2009.sav") # nolint
N2010 <- read_sav("Nacimientos/Nacimiento2010.sav") # nolint
N2011 <- read_sav("Nacimientos/Nacimiento2011.sav") # nolint
N2012 <- read_sav("Nacimientos/Nacimiento2012.sav") # nolint
N2013 <- read_sav("Nacimientos/Nacimiento2013.sav") # nolint
N2014 <- read_sav("Nacimientos/Nacimiento2014.sav") # nolint
N2015 <- read_sav("Nacimientos/Nacimiento2015.sav") # nolint
N2016 <- read_sav("Nacimientos/Nacimiento2016.sav") # nolint
N2017 <- read_sav("Nacimientos/Nacimiento2017.sav") # nolint
N2018 <- read_sav("Nacimientos/Nacimiento2018.sav") # nolint
N2019 <- read_sav("Nacimientos/Nacimiento2019.sav") # nolint
N2020 <- read_sav("Nacimientos/Nacimiento2020.sav") # nolint
N2021 <- read_sav("Nacimientos/Nacimiento2021.sav") # nolint
```
Divorcios
```{r}
D2009 <- read_sav("Divorcios/Divorcio2009.sav") # nolint
D2010 <- read_sav("Divorcios/Divorcio2010.sav") # nolint
D2011 <- read_sav("Divorcios/Divorcio2011.sav") # nolint
D2012 <- read_sav("Divorcios/Divorcio2012.sav") # nolint
D2013 <- read_sav("Divorcios/Divorcio2013.sav") # nolint
D2014 <- read_sav("Divorcios/Divorcio2014.sav") # nolint
D2015 <- read_sav("Divorcios/Divorcio2015.sav") # nolint
D2016 <- read_sav("Divorcios/Divorcio2016.sav") # nolint
D2017 <- read_sav("Divorcios/Divorcio2017.sav") # nolint
D2018 <- read_sav("Divorcios/Divorcio2018.sav") # nolint
D2019 <- read_sav("Divorcios/Divorcio2019.sav") # nolint
D2020 <- read_sav("Divorcios/Divorcio2020.sav") # nolint
D2021 <- read_sav("Divorcios/Divorcio2021.sav") # nolint


```


## Descripción variables y observaciones 
Comience describiendo cuantas variables y observaciones tiene disponibles, el
tipo de cada una de las variables.

Las bases de datos de matrimonios cuentan con diferentes cantidades de variables,pero las 22 más comunes son:
---Para divorcios---
DEPREG: cualitativa
MUPREG: cualitativa
MESREG: cualitativa
AÑOREG: cuantitativa discreta
DIAOCU: cuantitativa
MESOCU: cualitativa
ANOOCU: cuantitativa discreta
DEPOCU: cualitativa
MUPOCU: cualitativa
EDADHOM: cuantitativa discreta
EDADMUJ: cuantitativa discreta
GETHOM: cualitativa
GETMUJ: cualitativa
NACHOM: cualitativa
NACMUJ: cualitativa
OCUHOM: cualitativa
OCUMUJ: cualitativa
MEVER: cualitativa
ANOVER: cualitativa


## Resumen de datos 
Haga un resumen de las variables numéricas e investigue si siguen una
distribución normal y tablas de frecuencia para las variables categóricas, escriba lo
que vaya encontrando. 
```{r}
#summary(M2009)
# Crear una lista con los conjuntos de datos
datasets <- list(D2009, D2010, D2011, D2012, D2013, D2014, D2015, D2016, D2017, D2018, D2019, D2020, D2021)

# Crear un bucle for para analizar cada conjunto de datos y obtener los nombres de las variables numéricas
for (i in 1:length(datasets)) {
  vars_numéricas <- sapply(datasets[[i]], is.numeric)
  print(names(vars_numéricas[vars_numéricas]))
}
```


## Variables importantes
Cruce las variables que considere que son las más importantes para hallar los
elementos clave que lo pueden llevar a comprender lo que está causando el
problema encontrado.

Tiempo: Es importante poder ver el cambio a través del tiempo, si ha habido un incremente o decremento, tanto en matrimonios como en divorcios

NUNUHO:"Número de nupcias del hombre"
NUNUMU:"Número de nupcias de la mujer"

```{r}
M2021[, c(7, 8)]

```

Saber si una persona ha estado previamente casada y si esto influye en la posibilidad de divorcio, cómo hipotesis se espera que las personas que han tenido más de dos nupcias antes, son más propensas al divorcio

Edadhom: "Edad del hombre"
Edadmuj: "Edad de la mujer"

```{r}
D2021[, c(10, 11)]

```

La edad puede ser un dato interesante a explorar, esto para saber si los jovenes tienen más tendencia a casarse o divorcioarse y si los matrimonios más duraderos tienen menos divorcios

Genero: Es interesante ver que genero es más propenso a los divorcios, esto también puede estar relacionado con la cantidad de nupcias de una persona

Efectos de la pandemia: Ver como los divorcios y matrimonios se comportaron a partir de marzo de 2020 que fue el momento en que la cuarentena empezó a hacerse efectiva



## Graficos exploratorios 
Haga gráficos exploratorios que le de ideas del estado de los datos.
```{r}

```

## Clustering
Haga un agrupamiento (clustering) e interprete los resultados.
```{r}


```

-----------------------------------------------------------------------------------------
## Analisis

```{r}
  EdadMujD2009 <- sum(D2009$Edadmuj)
  EdadMujD2010 <- sum(D2010$edadmuj)
  EdadMujD2011 <- sum(D2011$edadmuj)
  EdadMujD2012 <- sum(D2012$EDADMUJ)
  EdadMujD2013 <- sum(D2013$EDADMUJ)
  EdadMujD2014 <- sum(D2014$EDADMUJ)
  EdadMujD2015 <- sum(D2015$EDADMUJ)
  EdadMujD2016 <- sum(D2016$EDADMUJ)
  EdadMujD2017 <- sum(D2017$EDADMUJ)
  EdadMujD2018 <- sum(D2018$EDADMUJ)
  EdadMujD2019 <- sum(D2019$EDADMUJ)
  EdadMujD2020 <- sum(D2020$EDADMUJ)
  EdadMujD2021 <- sum(D2021$EDADMUJ)
```

```{r}
dfD <- data.frame (año  = c("2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017","2018","2019","2020","2021"), matrimonios = c(EdadMujD2009, EdadMujD2010, EdadMujD2011, EdadMujD2012, EdadMujD2013, EdadMujD2014, EdadMujD2015, EdadMujD2016, EdadMujD2017, EdadMujD2018, EdadMujD2019, EdadMujD2020, EdadMujD2021))
print(dfD)
```

```{r}
ggplot(dfD, aes(x=año, y=matrimonios, group = 1)) + 
  geom_point(size = 2, color = "green") + 
  geom_line(color="green") +
  labs(x = "Año", y = "Divorcios", title = "Divorcios")
```

--------------------------------------------------------------------------------

## Histogramas
2009
```{r}
library(dplyr)
library(ggplot2)

D2009 <- subset(D2009, Edadmuj < 999)


barplot(table(D2009$Edadmuj), main = "Edad de la mujer en divorcios 2009", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2010
```{r}
D2010 <- subset(D2010, edadmuj < 999)

barplot(table(D2010$edadmuj), main = "Edad de la mujer en divorcios 2010", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2011
```{r}
D2011 <- subset(D2011, edadmuj < 999)

barplot(table(D2011$edadmuj), main = "Edad de la mujer en divorcios 2011", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2012
```{r}
D2012 <- subset(D2012, EDADMUJ < 999)

barplot(table(D2012$EDADMUJ), main = "Edad de la mujer en divorcios 2012", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2013
```{r}
D2013 <- subset(D2013, EDADMUJ < 999)

barplot(table(D2013$EDADMUJ), main = "Edad de la mujer en divorcios 2013", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2014
```{r}
D2014 <- subset(D2014, EDADMUJ < 999)

barplot(table(D2014$EDADMUJ), main = "Edad de la mujer en divorcios 2014", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2015
```{r}
D2015 <- subset(D2015, EDADMUJ < 999)

barplot(table(D2015$EDADMUJ), main = "Edad de la mujer en divorcios 2015", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2016
```{r}
D2016 <- subset(D2016, EDADMUJ < 999)

barplot(table(D2016$EDADMUJ), main = "Edad de la mujer en divorcios 2016", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2017
```{r}
D2017 <- subset(D2017, EDADMUJ < 999)

barplot(table(D2017$EDADMUJ), main = "Edad de la mujer en divorcios 2017", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2018
```{r}
D2018 <- subset(D2018, EDADMUJ < 999)

barplot(table(D2018$EDADMUJ), main = "Edad de la mujer en divorcios 2018", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2019
```{r}
D2019 <- subset(D2019, EDADMUJ < 999)

barplot(table(D2019$EDADMUJ), main = "Edad de la mujer en divorcios 2019", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2020
```{r}
D2020 <- subset(D2020, EDADMUJ < 999)

barplot(table(D2020$EDADMUJ), main = "Edad de la mujer en divorcios 2020", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```

2021
```{r}
D2021 <- subset(D2021, EDADMUJ < 999)

barplot(table(D2021$EDADMUJ), main = "Edad de la mujer en divorcios 2021", xlab = "Edad", ylab = "Cantidad", col = "steelblue" , border = "pink")
```
--------------------------------------------------------------------------
## Convinando datos
```{r}
colnames(D2009) <- c("DEPREG", "MUPREG", "MESREG", "AÑOREG", "DIAOCU", "MESOCU", "AÑOOCU", "DEPOCU", "MUPOCU", "EDADHOM", "EDADMUJ", "GETHOM", "GETMUJ", "NACHOM", "NACMUJ", "CIUOHOM", "CIUOMUJ", "Mever", "Anover")

colnames(D2010) <- c("DEPREG", "MUPREG", "MESREG", "AÑOREG", "DIAOCU", "MESOCU", "AÑOOCU", "DEPOCU", "MUPOCU", "EDADHOM", "EDADMUJ", "GETHOM", "GETMUJ", "NACHOM", "NACMUJ", "ESCHOM", "ESCMUJ", "CIUOHOM", "CIUOMUJ")

colnames(D2011) <- c("DEPREG", "MUPREG", "MESREG", "AÑOREG", "DIAOCU", "MESOCU", "AÑOOCU", "DEPOCU", "MUPOCU", "EDADHOM", "EDADMUJ", "GETHOM", "GETMUJ", "NACHOM", "NACMUJ", "ESCHOM", "ESCMUJ", "CIUOHOM", "CIUOMUJ")

colnames(D2012) <- c("DEPREG",  "MUPREG",  "MESREG",  "AÑOREG",  "DIAOCU",  "MESOCU",  "DEPOCU",  "MUPOCU", "EDADHOM", "EDADMUJ", "GETHOM",  "GETMUJ",  "NACHOM",  "NACMUJ",  "ESCHOM",  "ESCMUJ", "CIUOHOM",  "CIUOMUJ") 

```

```{r}
D2009 <- D2009 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2010 <- D2010 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2011 <- D2011 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2012 <- D2012 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2013 <- D2013 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2014 <- D2014 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2015 <- D2015 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2016 <- D2016 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2017 <- D2017 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2018 <- D2018 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2019 <- D2019 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2020 <- D2020 %>% mutate(AÑOREG = as.numeric(AÑOREG))
D2021 <- D2021 %>% mutate(AÑOREG = as.numeric(AÑOREG))
```

```{r}
D2009 <- D2009 %>% mutate(AÑOOCU = as.numeric(AÑOOCU))
D2010 <- D2010 %>% mutate(AÑOOCU = as.numeric(AÑOOCU))
D2011 <- D2011 %>% mutate(AÑOOCU = as.numeric(AÑOOCU))

```

```{r}
D2009 <- D2009 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2010 <- D2010 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2011 <- D2011 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2012 <- D2012 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2013 <- D2013 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2014 <- D2014 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2015 <- D2015 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2016 <- D2016 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2017 <- D2017 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2018 <- D2018 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2019 <- D2019 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2020 <- D2020 %>% mutate(CIUOHOM = as.character(CIUOHOM))
D2021 <- D2021 %>% mutate(CIUOHOM = as.character(CIUOHOM))
```


```{r}
D2009 <- D2009 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2010 <- D2010 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2011 <- D2011 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2012 <- D2012 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2013 <- D2013 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2014 <- D2014 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2015 <- D2015 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2016 <- D2016 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2017 <- D2017 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2018 <- D2018 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2019 <- D2019 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2020 <- D2020 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
D2021 <- D2021 %>% mutate(CIUOMUJ = as.character(CIUOMUJ))
```

```{r warning=FALSE, unload=TRUE}
#divorcios <- bind_rows(D2009, D2010, D2011, D2012, D2013, D2014, D2015, D2016, D2017, D2018, D2019, D2020, D2021)

divorcios <- bind_rows( D2012, D2013, D2014, D2015, D2016, D2017, D2018, D2019, D2020, D2021)
```

```{r}
str(divorcios)
```

```{r normalHist, echo=FALSE}
#install.packages("ggplot2",repos = "http://cran.us.r-project.org")
library (ggplot2)
ggplot(data = divorcios, aes(x = AÑOREG)) + 
  geom_histogram(aes(y=..density.., fill = ..count..))+
  scale_fill_gradient(low = "#DCDCDC", high = "#7C7C7C")+
  stat_function(fun = dnorm, colour = "firebrick",
                args = list(mean = mean(divorcios$AÑOREG),
                            sd = sd(divorcios$AÑOREG)))+
  ggtitle("Histograma con curva normal teórica de los registros de divorcios por año ") + 
  theme_bw()

```  


```{r}
boxplot(divorcios$AÑOREG, main = "Caja y Bigotes de registro de divorcios por año (2012 - 2021)", xlab = "Registro por año")
```


### Diagrama de qqnormal 
```{r normalQQ, echo=FALSE}
qqnorm(divorcios$AÑOREG, col="blue")
qqline(divorcios$AÑOREG, col="red")
```
